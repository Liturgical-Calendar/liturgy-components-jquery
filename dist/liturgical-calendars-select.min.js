/**
 * Calendars Select Plugin
 * @author [John Romano D'Orazio](https://github.com/JohnRDOrazio)
 * @license Apache-2.0
 * @version 1.0.0
 * @see https://github.com/Liturgical-Calendar/liturgy-components-jquery
 *
 * Description: Creates a select menu populated with available liturgical calendars from the Liturgical Calendar API
 * Usage: $('.calendars-select').liturgicalCalendarsSelect();
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}((function(a){let e=null;class n{static#a=[];static#e=[];static#n=[];#t=[];#i={};#o=[];#s=null;optionsBuilt=!1;constructor(a="en"){this.#s=new Intl.DisplayNames([a],{type:"region"})}static hasNationalCalendarWithDioceses(a){return n.#n.filter((e=>e?.calendar_id===a)).length>0}static addNationalCalendarWithDioceses(a){const e=n.#a.find((e=>e.calendar_id===a));n.#n.push(e)}static setNationalCalendars(a){n.#a=a}static setDiocesanCalendars(a){n.#e=a}addNationOption(a,e=!1){let n=`<option data-calendartype="national" value="${a.calendar_id}"${e?" selected":""}>${this.#s.of(a.calendar_id)}</option>`;this.#t.push(n)}addDioceseOption(a){let e=`<option data-calendartype="diocesan" value="${a.calendar_id}">${a.diocese}</option>`;this.#i[a.nation].push(e)}buildAllOptions(){this.optionsBuilt=!0,n.#e.forEach((a=>{!1===n.hasNationalCalendarWithDioceses(a.nation)&&n.addNationalCalendarWithDioceses(a.nation),!1===this.#i.hasOwnProperty(a.nation)&&(this.#i[a.nation]=[]),this.addDioceseOption(a)})),n.#a.sort(((a,e)=>this.#s.of(a.calendar_id).localeCompare(this.#s.of(e.calendar_id)))),n.#a.forEach((a=>{!1===n.hasNationalCalendarWithDioceses(a.calendar_id)&&("VA"===a.calendar_id?this.addNationOption(a,!0):this.addNationOption(a))})),n.#n.sort(((a,e)=>this.#s.of(a.calendar_id).localeCompare(this.#s.of(e.calendar_id)))),n.#n.forEach((a=>{this.addNationOption(a);let e=`<optgroup label="${this.#s.of(a.calendar_id)}">${this.#i[a.calendar_id].join("")}</optgroup>`;this.#o.push(e)}))}get nationsInnerHtml(){return this.#t.join("")}get diocesesInnerHtml(){return this.#o.join("")}}return a.fn.liturgicalCalendarsSelect=function(t){const i={apiVersion:"dev",selectClass:"",filter:"none",locale:"en"},o={};return this.each((function(){console.log(this.id);const s=a(this),l=a.extend({},i,t,s.data());console.log(`Settings: ${JSON.stringify(l)}`);let c=a("<select/>");function d(){console.log(`current settings: ${JSON.stringify(l)}`),"nations"===l.filter?c.html(o[l.locale].nationsInnerHtml):"dioceses"===l.filter?c.html(o[l.locale].diocesesInnerHtml):c.html(o[l.locale].nationsInnerHtml+o[l.locale].diocesesInnerHtml),s.replaceWith(c)}this.classList.length&&c.addClass(this.className),!1===o.hasOwnProperty(l.locale)&&(o[l.locale]=new n(l.locale)),l.selectClass&&c.addClass(l.selectClass),null===e?a.ajax({type:"GET",url:`https://litcal.johnromanodorazio.com/api/${l.apiVersion}/calendars`,async:!1,success:function(a){e=a;const{litcal_metadata:t}=e,{national_calendars:i,diocesan_calendars:s}=t;n.setNationalCalendars(i),n.setDiocesanCalendars(s),!1===o[l.locale].optionsBuilt&&o[l.locale].buildAllOptions(),d()}}):(!1===o[l.locale].optionsBuilt&&o[l.locale].buildAllOptions(),d())}))},a}));